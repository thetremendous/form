<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Формуляр за запитване за имот</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Custom styles to enhance the form */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Style for the radio button labels */
        .user-role-label {
            transition: all 0.2s ease-in-out;
        }
        /* Style for when radio button is checked */
        input[type="radio"]:checked + .user-role-label {
            background-color: #3b82f6; /* blue-500 */
            color: white;
            border-color: #3b82f6; /* blue-500 */
        }
        /* Hide the actual radio button */
        input[type="radio"] {
            display: none;
        }
        /* Language switcher styles */
        .lang-switcher button.active {
            background-color: #3b82f6;
            color: white;
        }
        /* Style for disabled button */
        button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        /* Class to prevent body scroll when a modal is open */
        .modal-open {
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4 sm:p-6 lg:p-8">

    <div id="form-container" class="w-full max-w-3xl bg-white rounded-xl shadow-lg p-6 sm:p-8 lg:p-10">
        
        <!-- Language Switcher -->
        <div class="lang-switcher flex justify-end mb-4">
            <div class="inline-flex rounded-md shadow-sm" role="group">
                <button type="button" id="lang-bg" class="px-4 py-2 text-sm font-medium text-gray-900 bg-white border border-gray-200 rounded-l-lg hover:bg-gray-100 focus:z-10 focus:ring-2 focus:ring-blue-500">
                    BG
                </button>
                <button type="button" id="lang-en" class="px-4 py-2 text-sm font-medium text-gray-900 bg-white border-t border-b border-r border-gray-200 rounded-r-lg hover:bg-gray-100 focus:z-10 focus:ring-2 focus:ring-blue-500">
                    EN
                </button>
            </div>
        </div>

        <div class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800" data-translate-key="main_title">Запитване за имот</h1>
            <p class="text-gray-500 mt-2" data-translate-key="main_subtitle">Моля, попълнете формуляра по-долу и ние ще се свържем с вас скоро.</p>
        </div>

        <!-- The form now points to your specific Formspree endpoint -->
        <form id="real-estate-inquiry-form" action="https://formspree.io/f/mjkrdyrp" method="POST">

            <!-- Step 1: User Role Selection -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold text-gray-700 mb-4" data-translate-key="user_role_title">Вие сте...</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <input type="radio" id="role-buyer" name="user_role" value="Buyer" checked onchange="toggleFormSections()">
                        <label for="role-buyer" class="user-role-label flex items-center justify-center w-full p-4 border border-gray-300 rounded-lg cursor-pointer text-lg font-medium text-gray-700" data-translate-key="role_buyer">
                            Купувач
                        </label>
                    </div>
                    <div>
                        <input type="radio" id="role-seller" name="user_role" value="Seller" onchange="toggleFormSections()">
                        <label for="role-seller" class="user-role-label flex items-center justify-center w-full p-4 border border-gray-300 rounded-lg cursor-pointer text-lg font-medium text-gray-700" data-translate-key="role_seller">
                            Продавач
                        </label>
                    </div>
                </div>
            </div>

            <!-- Dynamic Sections for Buyer and Seller -->
            <div id="buyer-section">
                <h3 class="text-xl font-semibold text-gray-700 mb-6 border-b pb-2" data-translate-key="buyer_info_title">Информация за купувача</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Budget -->
                    <div>
                        <label for="budget" class="block text-sm font-medium text-gray-600 mb-1" data-translate-key="budget_label">Бюджет (€)</label>
                        <select name="budget" id="budget" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 bg-white">
                            <option value="<150000" data-translate-key="budget_option_1">Под 150,000 €</option>
                            <option value="150000-300000" data-translate-key="budget_option_2">150,000 € - 300,000 €</option>
                            <option value=">300000" data-translate-key="budget_option_3">Над 300,000 €</option>
                        </select>
                    </div>
                    <!-- Area of Living -->
                    <div>
                        <label for="area" class="block text-sm font-medium text-gray-600 mb-1" data-translate-key="area_label">Предпочитан(и) район(и)</label>
                        <input type="text" name="area" id="area" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" data-translate-key="area_placeholder" placeholder="напр. Център, Северни квартали">
                    </div>
                    <!-- Square Meters -->
                    <div>
                        <label for="buyer-sqm" class="block text-sm font-medium text-gray-600 mb-1" data-translate-key="sqm_label_buyer">Желана квадратура (м²)</label>
                        <input type="text" name="desired_sqm" id="buyer-sqm" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" data-translate-key="sqm_placeholder_buyer" placeholder="напр. 120">
                    </div>
                    <!-- Bedrooms -->
                    <div>
                        <label for="buyer-bedrooms" class="block text-sm font-medium text-gray-600 mb-1" data-translate-key="bedrooms_label_buyer">Брой спални</label>
                        <input type="number" name="desired_bedrooms" id="buyer-bedrooms" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" data-translate-key="bedrooms_placeholder_buyer" placeholder="напр. 3">
                    </div>
                    <!-- Property Type -->
                    <div class="md:col-span-2">
                        <label for="property-type" class="block text-sm font-medium text-gray-600 mb-1" data-translate-key="property_type_label">Тип имот</label>
                        <select name="property_type" id="property-type" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 bg-white">
                            <option data-translate-key="property_type_house">Къща</option>
                            <option data-translate-key="property_type_flat" selected>Апартамент</option>
                            <option data-translate-key="property_type_condo">Кондо</option>
                            <option data-translate-key="property_type_townhouse">Градска къща</option>
                            <option data-translate-key="property_type_land">Земя</option>
                            <option data-translate-key="property_type_other">Друго</option>
                        </select>
                    </div>
                     <!-- Parking/Garage Options -->
                    <div class="md:col-span-2">
                         <label class="block text-sm font-medium text-gray-600 mb-2" data-translate-key="parking_needs_label">Нужди за паркиране</label>
                         <div class="flex items-center space-x-6">
                            <div class="flex items-center">
                                <input id="buyer-garage" name="buyer_needs_garage" type="checkbox" value="Yes" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                <label for="buyer-garage" class="ml-2 block text-sm text-gray-900" data-translate-key="garage_label">Гараж</label>
                            </div>
                            <div class="flex items-center">
                                <input id="buyer-parking" name="buyer_needs_parking_spot" type="checkbox" value="Yes" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                <label for="buyer-parking" class="ml-2 block text-sm text-gray-900" data-translate-key="parking_spot_label">Паркомясто</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="seller-section" class="hidden">
                 <h3 class="text-xl font-semibold text-gray-700 mb-6 border-b pb-2" data-translate-key="seller_info_title">Информация за продавача</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Year of Building -->
                    <div>
                        <label for="year-built" class="block text-sm font-medium text-gray-600 mb-1" data-translate-key="year_built_label">Година на строеж</label>
                        <input type="number" name="year_built" id="year-built" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" data-translate-key="year_built_placeholder" placeholder="напр. 1995">
                    </div>
                    <!-- Square Meters -->
                    <div>
                        <label for="seller-sqm" class="block text-sm font-medium text-gray-600 mb-1" data-translate-key="sqm_label_seller">Квадратура (м²)</label>
                        <input type="text" name="property_sqm" id="seller-sqm" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" data-translate-key="sqm_placeholder_seller" placeholder="напр. 150">
                    </div>
                    <!-- Bedrooms -->
                    <div class="md:col-span-2">
                        <label for="seller-bedrooms" class="block text-sm font-medium text-gray-600 mb-1" data-translate-key="bedrooms_label_seller">Брой спални</label>
                        <input type="number" name="property_bedrooms" id="seller-bedrooms" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" data-translate-key="bedrooms_placeholder_seller" placeholder="напр. 4">
                    </div>
                    <!-- Parking/Garage Options -->
                    <div class="md:col-span-2">
                         <label class="block text-sm font-medium text-gray-600 mb-2" data-translate-key="property_features_label">Характеристики на имота</label>
                         <div class="flex items-center space-x-6">
                            <div class="flex items-center">
                                <input id="seller-garage" name="property_has_garage" type="checkbox" value="Yes" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                <label for="seller-garage" class="ml-2 block text-sm text-gray-900" data-translate-key="garage_label_seller">Гараж</label>
                            </div>
                            <div class="flex items-center">
                                <input id="seller-parking" name="property_has_parking_spot" type="checkbox" value="Yes" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                <label for="seller-parking" class="ml-2 block text-sm text-gray-900" data-translate-key="parking_spot_label_seller">Паркомясто</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 3: Common Contact Information -->
            <div class="mt-8 pt-6 border-t">
                 <h3 class="text-xl font-semibold text-gray-700 mb-6" data-translate-key="contact_details_title">Данни за контакт</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Name -->
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-600 mb-1" data-translate-key="full_name_label">Пълно име</label>
                        <input type="text" name="name" id="name" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" data-translate-key="full_name_placeholder" placeholder="Иван Иванов">
                    </div>
                    <!-- Phone -->
                    <div>
                        <label for="phone" class="block text-sm font-medium text-gray-600 mb-1" data-translate-key="phone_label">Телефонен номер</label>
                        <input type="tel" name="phone" id="phone" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" data-translate-key="phone_placeholder" placeholder="+359 88 123 4567">
                    </div>
                    <!-- Email -->
                    <div class="md:col-span-2">
                        <label for="email" class="block text-sm font-medium text-gray-600 mb-1" data-translate-key="email_label">Имейл адрес</label>
                        <input type="email" name="email" id="email" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" data-translate-key="email_placeholder" placeholder="vasia@primer.com">
                    </div>
                    <!-- Additional Information -->
                    <div class="md:col-span-2">
                        <label for="message" class="block text-sm font-medium text-gray-600 mb-1" data-translate-key="additional_info_label">Допълнителна информация</label>
                        <textarea name="message" id="message" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" data-translate-key="additional_info_placeholder" placeholder="Има ли нещо друго, което бихте искали да споделите?"></textarea>
                    </div>
                </div>
            </div>

            <!-- Submission Button -->
            <div class="mt-8 text-center">
                <button type="submit" id="submit-button" class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-12 rounded-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300" data-translate-key="submit_button">
                    Изпрати запитване
                </button>
            </div>
        </form>
    </div>
    
    <!-- Error Modal -->
    <div id="error-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50">
        <div class="relative mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900" data-translate-key="error_modal_title">Грешка при изпращане</h3>
                <div class="mt-2 px-7 py-3">
                    <p id="error-message" class="text-sm text-gray-500" data-translate-key="error_modal_message">Възникна проблем при изпращането на формуляра. Моля, опитайте отново.</p>
                </div>
                <div class="items-center px-4 py-3">
                    <button id="close-error-modal-btn" class="px-4 py-2 bg-blue-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-300" data-translate-key="error_modal_close">
                        Затвори
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentLang = 'bg'; // To keep track of the current language

        // Translations object
        const translations = {
            en: {
                main_title: 'Real Estate Inquiry',
                main_subtitle: 'Please fill out the form below and we will get back to you shortly.',
                user_role_title: 'Are you a...',
                role_buyer: 'Buyer',
                role_seller: 'Seller',
                buyer_info_title: "Buyer's Information",
                budget_label: 'Budget (€)',
                budget_option_1: 'Under 150,000 €',
                budget_option_2: '150,000 € - 300,000 €',
                budget_option_3: 'Over 300,000 €',
                area_label: 'Preferred Area(s)',
                area_placeholder: 'e.g., Downtown, North Suburbs',
                sqm_label_buyer: 'Desired Square Meters (m²)',
                sqm_placeholder_buyer: 'e.g., 120',
                bedrooms_label_buyer: 'Number of Bedrooms',
                bedrooms_placeholder_buyer: 'e.g., 3',
                property_type_label: 'Type of Property',
                property_type_house: 'House',
                property_type_flat: 'Apartment / Flat',
                property_type_condo: 'Condo',
                property_type_townhouse: 'Townhouse',
                property_type_land: 'Land',
                property_type_other: 'Other',
                parking_needs_label: 'Parking Needs',
                garage_label: 'Garage',
                parking_spot_label: 'Parking Spot',
                seller_info_title: "Seller's Information",
                year_built_label: 'Year of Building',
                year_built_placeholder: 'e.g., 1995',
                sqm_label_seller: 'Square Meters (m²)',
                sqm_placeholder_seller: 'e.g., 150',
                bedrooms_label_seller: 'Number of Bedrooms',
                bedrooms_placeholder_seller: 'e.g., 4',
                property_features_label: 'Property Features',
                garage_label_seller: 'Garage',
                parking_spot_label_seller: 'Parking Spot',
                contact_details_title: 'Contact Details',
                full_name_label: 'Full Name',
                full_name_placeholder: 'John Doe',
                phone_label: 'Phone Number',
                phone_placeholder: '+1 (555) 123-4567',
                email_label: 'Email Address',
                email_placeholder: 'you@example.com',
                additional_info_label: 'Additional Information',
                additional_info_placeholder: "Is there anything else you'd like to share?",
                submit_button: 'Submit Inquiry',
                submit_button_sending: 'Sending...',
                success_title: 'Thank You!',
                success_message: 'Your inquiry has been submitted successfully. We will contact you shortly.',
                error_modal_title: 'Submission Error',
                error_modal_message: 'There was a problem submitting your form. Please try again.',
                error_modal_close: 'Close',
            },
            bg: {
                main_title: 'Запитване за имот',
                main_subtitle: 'Моля, попълнете формуляра по-долу и ние ще се свържем с вас скоро.',
                user_role_title: 'Вие сте...',
                role_buyer: 'Купувач',
                role_seller: 'Продавач',
                buyer_info_title: 'Информация за купувача',
                budget_label: 'Бюджет (€)',
                budget_option_1: 'Под 150,000 €',
                budget_option_2: '150,000 € - 300,000 €',
                budget_option_3: 'Над 300,000 €',
                area_label: 'Предпочитан(и) район(и)',
                area_placeholder: 'напр. Център, Северни квартали',
                sqm_label_buyer: 'Желана квадратура (м²)',
                sqm_placeholder_buyer: 'напр. 120',
                bedrooms_label_buyer: 'Брой спални',
                bedrooms_placeholder_buyer: 'напр. 3',
                property_type_label: 'Тип имот',
                property_type_house: 'Къща',
                property_type_flat: 'Апартамент',
                property_type_condo: 'Кондо',
                property_type_townhouse: 'Градска къща',
                property_type_land: 'Земя',
                property_type_other: 'Друго',
                parking_needs_label: 'Нужди за паркиране',
                garage_label: 'Гараж',
                parking_spot_label: 'Паркомясто',
                seller_info_title: 'Информация за продавача',
                year_built_label: 'Година на строеж',
                year_built_placeholder: 'напр. 1995',
                sqm_label_seller: 'Квадратура (м²)',
                sqm_placeholder_seller: 'напр. 150',
                bedrooms_label_seller: 'Брой спални',
                bedrooms_placeholder_seller: 'напр. 4',
                property_features_label: 'Характеристики на имота',
                garage_label_seller: 'Гараж',
                parking_spot_label_seller: 'Паркомясто',
                contact_details_title: 'Данни за контакт',
                full_name_label: 'Пълно име',
                full_name_placeholder: 'Иван Иванов',
                phone_label: 'Телефонен номер',
                phone_placeholder: '+359 88 123 4567',
                email_label: 'Имейл адрес',
                email_placeholder: 'vasia@primer.com',
                additional_info_label: 'Допълнителна информация',
                additional_info_placeholder: 'Има ли нещо друго, което бихте искали да споделите?',
                submit_button: 'Изпрати запитване',
                submit_button_sending: 'Изпращане...',
                success_title: 'Благодарим Ви!',
                success_message: 'Вашето запитване беше изпратено успешно. Ще се свържем с Вас скоро.',
                error_modal_title: 'Грешка при изпращане',
                error_modal_message: 'Възникна проблем при изпращането на формуляра. Моля, опитайте отново.',
                error_modal_close: 'Затвори',
            }
        };

        /**
         * Switches the form's language.
         * @param {string} lang - The language code ('en' or 'bg').
         */
        function setLanguage(lang) {
            currentLang = lang;
            document.documentElement.lang = lang;
            document.title = lang === 'bg' ? 'Формуляр за запитване за имот' : 'Real Estate Inquiry Form';
            
            const elements = document.querySelectorAll('[data-translate-key]');
            elements.forEach(el => {
                const key = el.getAttribute('data-translate-key');
                const translation = translations[lang][key];
                if (translation !== undefined) {
                    if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                        el.placeholder = translation;
                    } else {
                        el.innerHTML = translation;
                    }
                }
            });
            
            // Update active state on buttons
            document.getElementById('lang-bg').classList.toggle('active', lang === 'bg');
            document.getElementById('lang-en').classList.toggle('active', lang === 'en');
        }

        /**
         * Toggles the visibility of the buyer and seller form sections.
         */
        function toggleFormSections() {
            const buyerSection = document.getElementById('buyer-section');
            const sellerSection = document.getElementById('seller-section');
            
            if (document.getElementById('role-buyer').checked) {
                buyerSection.classList.remove('hidden');
                sellerSection.classList.add('hidden');
            } else {
                buyerSection.classList.add('hidden');
                sellerSection.classList.remove('hidden');
            }
        }

        // Initialize maps and set initial form state when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            toggleFormSections();

            document.getElementById('lang-bg').addEventListener('click', () => setLanguage('bg'));
            document.getElementById('lang-en').addEventListener('click', () => setLanguage('en'));

            setLanguage('bg');

            // Handle Form Submission with AJAX
            const form = document.getElementById('real-estate-inquiry-form');
            const submitButton = document.getElementById('submit-button');
            const errorModal = document.getElementById('error-modal');
            const closeErrorModalBtn = document.getElementById('close-error-modal-btn');

            form.addEventListener('submit', async function(event) {
                event.preventDefault(); // Stop default form submission

                const originalButtonText = submitButton.innerHTML;
                submitButton.disabled = true;
                submitButton.innerHTML = translations[currentLang].submit_button_sending;

                const formData = new FormData(form);
                const formAction = form.getAttribute('action');

                fetch(formAction, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Accept': 'application/json'
                    }
                })
                .then(response => {
                    if (response.ok) {
                        const formContainer = document.getElementById('form-container');
                        const successTitle = translations[currentLang].success_title;
                        const successMessage = translations[currentLang].success_message;
                        formContainer.innerHTML = `<div class="text-center p-8"><h2 class="text-2xl font-bold text-green-600">${successTitle}</h2><p class="text-gray-600 mt-4">${successMessage}</p></div>`;
                    } else {
                        response.json().then(data => {
                            console.error("Formspree error:", data);
                            errorModal.classList.remove('hidden');
                        }).catch(() => {
                            errorModal.classList.remove('hidden');
                        });
                        submitButton.disabled = false;
                        submitButton.innerHTML = originalButtonText;
                    }
                })
                .catch(error => {
                    console.error("Network error:", error);
                    errorModal.classList.remove('hidden');
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalButtonText;
                });
            });

            closeErrorModalBtn.addEventListener('click', function() {
                errorModal.classList.add('hidden');
            });
        });
    </script>

</body>
</html>
