<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Формуляр за запитване за имот</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter for body and Playfair Display for headlines -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet">
    <!-- GSAP for Scrollytelling Animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/ScrollTrigger.min.js"></script>
    <!-- NOTE: Google Places API requires a key. Replace YOUR_API_KEY with your actual key. -->
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places&callback=initAutocomplete" async defer></script>
    
    <style>
        /* Custom styles to enhance the form with a dynamic color palette and new typography */
        :root {
            --color-bg: #f4f1eb; /* Sand */
            --color-surface: #ffffff; /* White */
            --color-text-primary: #333333; /* Charcoal */
            --color-text-secondary: #6b7280; /* Soft Gray */
            --color-border: #d1d5db; /* Soft Gray */
            
            /* Default Accent Color (will be overridden by user selection) */
            --color-accent: #0ea5e9; /* Vibrant Sky Blue */
            --color-accent-hover: #0284c7;
            --color-accent-ring: #7dd3fc;

            --font-body: 'Inter', sans-serif;
            --font-headline: 'Playfair Display', serif;
        }

        body {
            font-family: var(--font-body);
            background-color: var(--color-bg);
            color: var(--color-text-primary);
        }

        .form-container-themed {
            background-color: var(--color-surface);
        }

        .border-themed {
            border-color: var(--color-border);
        }
        
        .h-themed {
             color: var(--color-text-primary);
             font-family: var(--font-headline);
             font-weight: 800;
        }

        .h-section-themed {
             color: var(--color-text-primary);
             font-family: var(--font-body);
             font-weight: 600;
        }

        .p-themed {
            color: var(--color-text-secondary);
        }

        .user-role-label {
            transition: all 0.2s ease-in-out;
            border-color: var(--color-border);
            color: var(--color-text-secondary);
        }
        
        input[type="radio"]:checked + .user-role-label {
            background-color: var(--color-accent);
            color: white;
            border-color: var(--color-accent);
        }

        input[type="radio"] {
            display: none;
        }

        .lang-switcher button.active {
            background-color: var(--color-accent);
            color: white;
        }
        
        .form-input-themed {
            border-color: var(--color-border);
        }

        .form-input-themed:focus {
            --tw-ring-color: var(--color-accent-ring);
            border-color: var(--color-accent);
        }
        
        .checkbox-themed {
             color: var(--color-accent);
        }
        
        .submit-button-themed {
            background-color: var(--color-accent);
            color: white;
        }
        .submit-button-themed:hover {
             background-color: var(--color-accent-hover);
        }
        .submit-button-themed:focus {
             --tw-ring-color: var(--color-accent-ring);
        }

        button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        .modal-open {
            overflow: hidden;
        }
        
        /* Initial state for scroll animations */
        .scroll-reveal {
            opacity: 0;
            transform: translateY(30px);
        }
        
        /* Progress Bar */
        .progress-bar-container {
            width: 100%;
            background-color: #e5e7eb;
            border-radius: 9999px;
            height: 8px;
            margin-bottom: 2rem;
        }
        .progress-bar {
            background-color: var(--color-accent);
            height: 100%;
            width: 0%;
            border-radius: 9999px;
            transition: width 0.4s ease;
        }
        
        /* Real-time validation styles */
        .validation-icon {
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 sm:p-6 lg:p-8">

    <div id="form-container" class="form-container-themed w-full max-w-4xl rounded-xl shadow-lg p-6 sm:p-8 lg:p-10 relative">
        
        <!-- Top Icons -->
        <div class="absolute top-6 left-6 flex gap-3">
            <button id="openBusinessCard" class="w-16 h-16 rounded-full bg-cover border-2 border-slate-600 hover:border-sky-400 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-2 focus:ring-offset-slate-100" style="background-image: url('https://i.ibb.co/RpjmSmGd/485729087-122205037196106247-8647253442657459283-n.jpg'); background-position: center 25%;" aria-label="Open Business Card"></button>
            <button id="openColorPicker" class="w-16 h-16 rounded-full bg-gray-200 flex items-center justify-center border-2 border-slate-600 hover:border-sky-400 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-2 focus:ring-offset-slate-100" aria-label="Change Theme Color">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" />
                </svg>
            </button>
        </div>

        <!-- Language Switcher -->
        <div class="lang-switcher flex justify-end mb-4">
            <div class="inline-flex rounded-md shadow-sm" role="group">
                <button type="button" id="lang-bg" class="px-4 py-2 text-sm font-medium bg-white border border-gray-200 rounded-l-lg hover:bg-gray-100 focus:z-10 focus:ring-2">
                    BG
                </button>
                <button type="button" id="lang-en" class="px-4 py-2 text-sm font-medium bg-white border-t border-b border-r border-gray-200 rounded-r-lg hover:bg-gray-100 focus:z-10 focus:ring-2">
                    EN
                </button>
            </div>
        </div>

        <div class="text-center mb-8 scroll-reveal">
            <h1 class="h-themed text-4xl sm:text-5xl" data-translate-key="main_title">Запитване за имот</h1>
            <p class="p-themed mt-4 text-lg" data-translate-key="main_subtitle">Моля, попълнете формуляра по-долу и ние ще се свържем с вас скоро.</p>
        </div>
        
        <!-- Progress Bar -->
        <div class="progress-bar-container scroll-reveal">
            <div id="progress-bar" class="progress-bar"></div>
        </div>

        <!-- The form now points to your specific Formspree endpoint -->
        <form id="real-estate-inquiry-form" action="https://formspree.io/f/mjkrdyrp" method="POST" enctype="multipart/form-data">
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Box 1: User Role -->
                <div class="p-6 rounded-lg border border-themed scroll-reveal" data-step="1">
                    <h2 class="h-section-themed text-xl font-semibold mb-4" data-translate-key="user_role_title">Вие сте...</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <input type="radio" id="role-buyer" name="user_role" value="Buyer" checked onchange="toggleFormSections()">
                            <label for="role-buyer" class="user-role-label flex items-center justify-center w-full p-4 rounded-lg cursor-pointer text-lg font-medium" data-translate-key="role_buyer">
                                Купувач
                            </label>
                        </div>
                        <div>
                            <input type="radio" id="role-seller" name="user_role" value="Seller" onchange="toggleFormSections()">
                            <label for="role-seller" class="user-role-label flex items-center justify-center w-full p-4 rounded-lg cursor-pointer text-lg font-medium" data-translate-key="role_seller">
                                Продавач
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Box 2: Property Details -->
                <div class="p-6 rounded-lg border border-themed scroll-reveal" data-step="1">
                    <h3 class="h-section-themed text-xl font-semibold mb-4" data-translate-key="property_details_title">Детайли за имота</h3>
                    <div class="grid grid-cols-1 gap-6">
                        <!-- Property Type -->
                        <div>
                            <label for="property-type" id="property-type-label" class="block text-sm font-medium p-themed mb-1" data-translate-key="property_type_label_buyer">Какъв имот търсите?</label>
                            <select name="property_type" id="property-type" class="w-full px-4 py-2 border rounded-lg focus:ring-2 form-input-themed bg-white">
                                <option data-translate-key="property_type_house">Къща</option>
                                <option data-translate-key="property_type_flat" selected>Апартамент</option>
                                <option data-translate-key="property_type_parcel">Парцел</option>
                                <option data-translate-key="property_type_business_building">Бизнес сграда</option>
                                <option data-translate-key="property_type_living_building">Жилищна сграда</option>
                                <option data-translate-key="property_type_vacational_property">Ваканционен имот</option>
                            </select>
                        </div>
                        <!-- Square Meters -->
                        <div>
                            <label for="sqm" id="sqm-label" class="block text-sm font-medium p-themed mb-1" data-translate-key="sqm_label_buyer">Желана квадратура (м²)</label>
                            <input type="text" name="sqm" id="sqm" class="w-full px-4 py-2 border rounded-lg focus:ring-2 form-input-themed" data-translate-key="sqm_placeholder" placeholder="напр. 120-150">
                        </div>
                        <!-- Bedrooms -->
                        <div id="bedrooms-container">
                            <label for="bedrooms" class="block text-sm font-medium p-themed mb-1" data-translate-key="bedrooms_label">Брой спални</label>
                            <input type="number" name="bedrooms" id="bedrooms" class="w-full px-4 py-2 border rounded-lg focus:ring-2 form-input-themed" data-translate-key="bedrooms_placeholder" placeholder="напр. 3">
                        </div>
                    </div>
                </div>

                <!-- Box 3: Buyer/Seller Details (Spanning full width) -->
                <div class="lg:col-span-2 p-6 rounded-lg border border-themed scroll-reveal" data-step="2">
                    <div id="buyer-section">
                        <h3 class="h-section-themed text-xl font-semibold mb-4" data-translate-key="buyer_info_title">Информация за купувача</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Budget -->
                            <div id="budget-container">
                                <label for="budget-text" class="block text-sm font-medium p-themed mb-1" data-translate-key="budget_label_buyer">Какъв е Вашият бюджет?</label>
                                <input type="text" name="budget" id="budget-text" class="w-full px-4 py-2 border rounded-lg focus:ring-2 form-input-themed" data-translate-key="budget_placeholder" placeholder="напр. 125000">
                            </div>
                            <!-- Area of Living -->
                            <div>
                                <label for="area" class="block text-sm font-medium p-themed mb-1" data-translate-key="area_label">Предпочитан(и) район(и)</label>
                                <input type="text" name="area" id="area" class="w-full px-4 py-2 border rounded-lg focus:ring-2 form-input-themed" data-translate-key="area_placeholder" placeholder="напр. Център, Северни квартали">
                            </div>
                            <!-- Financing Status -->
                            <div>
                                <label for="financing-status" class="block text-sm font-medium p-themed mb-1" data-translate-key="financing_status_label">Статус на финансиране</label>
                                <select name="financing_status" id="financing-status" class="w-full px-4 py-2 border rounded-lg focus:ring-2 form-input-themed bg-white">
                                    <option data-translate-key="financing_status_preapproved">Предварително одобрен за кредит</option>
                                    <option data-translate-key="financing_status_cash">Плащане в брой</option>
                                    <option data-translate-key="financing_status_need_loan">Трябва да кандидатствам за кредит</option>
                                    <option data-translate-key="financing_status_starting">Проучвам възможности</option>
                                </select>
                            </div>
                            <!-- Purchase Timeline -->
                            <div>
                                <label for="purchase-timeline" class="block text-sm font-medium p-themed mb-1" data-translate-key="purchase_timeline_label">Кога планирате да купите?</label>
                                <select name="purchase_timeline" id="purchase-timeline" class="w-full px-4 py-2 border rounded-lg focus:ring-2 form-input-themed bg-white">
                                    <option data-translate-key="timeline_immediately">Веднага</option>
                                    <option data-translate-key="timeline_1_3_months">1-3 месеца</option>
                                    <option data-translate-key="timeline_3_6_months">3-6 месеца</option>
                                    <option data-translate-key="timeline_6_plus_months">6+ месеца</option>
                                </select>
                            </div>
                            <!-- Must-Have Features -->
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium p-themed mb-2" data-translate-key="must_have_features_label">Задължителни екстри</label>
                                <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                                    <div class="flex items-center">
                                        <input id="feature-balcony" name="features[]" value="Balcony" type="checkbox" class="h-4 w-4 border-gray-300 rounded focus:ring-2 checkbox-themed">
                                        <label for="feature-balcony" class="ml-2 block text-sm" data-translate-key="feature_balcony">Балкон/Тераса</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input id="feature-renovated" name="features[]" value="Renovated" type="checkbox" class="h-4 w-4 border-gray-300 rounded focus:ring-2 checkbox-themed">
                                        <label for="feature-renovated" class="ml-2 block text-sm" data-translate-key="feature_renovated">Реновиран</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input id="feature-pet-friendly" name="features[]" value="Pet-Friendly" type="checkbox" class="h-4 w-4 border-gray-300 rounded focus:ring-2 checkbox-themed">
                                        <label for="feature-pet-friendly" class="ml-2 block text-sm" data-translate-key="feature_pet_friendly">Подходящ за домашни любимци</label>
                                    </div>
                                </div>
                            </div>
                            <!-- Parking/Garage Options -->
                            <div id="parking-container" class="md:col-span-2">
                                <label class="block text-sm font-medium p-themed mb-2" data-translate-key="parking_needs_label">Нужди за паркиране</label>
                                <div class="flex items-center space-x-6">
                                    <div class="flex items-center">
                                        <input id="buyer-garage" name="buyer_needs_garage" type="checkbox" value="Yes" class="h-4 w-4 border-gray-300 rounded focus:ring-2 checkbox-themed">
                                        <label for="buyer-garage" class="ml-2 block text-sm" data-translate-key="garage_label">Гараж</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input id="buyer-parking" name="buyer_needs_parking_spot" type="checkbox" value="Yes" class="h-4 w-4 border-gray-300 rounded focus:ring-2 checkbox-themed">
                                        <label for="buyer-parking" class="ml-2 block text-sm" data-translate-key="parking_spot_label">Паркомясто</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="seller-section" class="hidden">
                        <h3 class="h-section-themed text-xl font-semibold mb-4" data-translate-key="seller_info_title">Информация за продавача</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Year of Building -->
                            <div id="year-built-container">
                                <label for="year-built" class="block text-sm font-medium p-themed mb-1" data-translate-key="year_built_label">Година на строеж</label>
                                <input type="number" name="year_built" id="year-built" class="w-full px-4 py-2 border rounded-lg focus:ring-2 form-input-themed" data-translate-key="year_built_placeholder" placeholder="напр. 1995">
                            </div>
                            <!-- Type of Building -->
                            <div id="building-type-container">
                                <label for="building-type" class="block text-sm font-medium p-themed mb-1" data-translate-key="building_type_label">Тип на сградата</label>
                                <select name="building_type" id="building-type" class="w-full px-4 py-2 border rounded-lg focus:ring-2 form-input-themed bg-white">
                                    <option data-translate-key="building_type_tuhla">Тухла</option>
                                    <option data-translate-key="building_type_epk">ЕПК</option>
                                    <option data-translate-key="building_type_panel">Панел</option>
                                </select>
                            </div>
                             <!-- Property Condition -->
                            <div>
                                <label for="property-condition" class="block text-sm font-medium p-themed mb-1" data-translate-key="property_condition_label">Състояние на имота</label>
                                <select name="property_condition" id="property-condition" class="w-full px-4 py-2 border rounded-lg focus:ring-2 form-input-themed bg-white">
                                    <option data-translate-key="condition_move_in">Готов за нанасяне</option>
                                    <option data-translate-key="condition_minor_updates">Нуждае се от леки подобрения</option>
                                    <option data-translate-key="condition_major_renovation">Нуждае се от основен ремонт</option>
                                </select>
                            </div>
                             <!-- Reason for Selling -->
                            <div>
                                <label for="reason-for-selling" class="block text-sm font-medium p-themed mb-1" data-translate-key="reason_for_selling_label">Причина за продажба (по желание)</label>
                                <input type="text" name="reason_for_selling" id="reason-for-selling" class="w-full px-4 py-2 border rounded-lg focus:ring-2 form-input-themed">
                            </div>
                             <!-- Photo Upload -->
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium p-themed mb-1" data-translate-key="photo_upload_label">Качете снимки на имота</label>
                                <input type="file" name="property_photos[]" id="property-photos" multiple accept="image/*" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"/>
                                <div id="photo-previews" class="mt-4 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"></div>
                            </div>
                            <!-- Parking/Garage Options -->
                            <div id="seller-parking-container" class="md:col-span-2">
                                <label class="block text-sm font-medium p-themed mb-2" data-translate-key="property_features_label">Характеристики на имота</label>
                                <div class="flex items-center space-x-6">
                                    <div class="flex items-center">
                                        <input id="seller-garage" name="property_has_garage" type="checkbox" value="Yes" class="h-4 w-4 border-gray-300 rounded focus:ring-2 checkbox-themed">
                                        <label for="seller-garage" class="ml-2 block text-sm" data-translate-key="garage_label_seller">Гараж</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input id="seller-parking" name="property_has_parking_spot" type="checkbox" value="Yes" class="h-4 w-4 border-gray-300 rounded focus:ring-2 checkbox-themed">
                                        <label for="seller-parking" class="ml-2 block text-sm" data-translate-key="parking_spot_label_seller">Паркомясто</label>
                                    </div>
                                </div>
                            </div>
                            <!-- Sell within 6 months -->
                            <div class="md:col-span-2">
                                <div class="flex items-start">
                                    <div class="flex items-center h-5">
                                        <input id="sell-within-6-months" name="sell_within_6_months" type="checkbox" value="Yes" class="focus:ring-2 h-4 w-4 border-gray-300 rounded checkbox-themed">
                                    </div>
                                    <div class="ml-3 text-sm">
                                        <label for="sell-within-6-months" class="font-medium" data-translate-key="sell_within_6_months_label">Искам да продам в рамките на следващите 6 месеца</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Box 4: Contact Details (Spanning full width) -->
                <div class="lg:col-span-2 p-6 rounded-lg border border-themed scroll-reveal" data-step="3">
                    <h3 class="h-section-themed text-xl font-semibold mb-4" data-translate-key="contact_details_title">Данни за контакт</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Name -->
                        <div>
                            <label for="name" class="block text-sm font-medium p-themed mb-1" data-translate-key="full_name_label">Вашите имена</label>
                            <input type="text" name="name" id="name" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 form-input-themed" data-translate-key="full_name_placeholder" placeholder="Иван Иванов">
                        </div>
                        <!-- Phone -->
                        <div class="relative">
                            <label for="phone" class="block text-sm font-medium p-themed mb-1" data-translate-key="phone_label">Телефонен номер</label>
                            <input type="tel" name="phone" id="phone" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 form-input-themed" data-translate-key="phone_placeholder" placeholder="+359 88 123 4567">
                            <span id="phone-validation-icon" class="validation-icon hidden"></span>
                        </div>
                        <!-- Email -->
                        <div class="md:col-span-2 relative">
                            <label for="email" class="block text-sm font-medium p-themed mb-1" data-translate-key="email_label">Имейл адрес</label>
                            <input type="email" name="email" id="email" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 form-input-themed" data-translate-key="email_placeholder" placeholder="vasia@primer.com">
                            <span id="email-validation-icon" class="validation-icon hidden"></span>
                        </div>
                        <!-- Additional Information -->
                        <div class="md:col-span-2">
                            <label for="message" class="block text-sm font-medium p-themed mb-1" data-translate-key="additional_info_label">Допълнителна информация</label>
                            <textarea name="message" id="message" rows="4" class="w-full px-4 py-2 border rounded-lg focus:ring-2 form-input-themed" data-translate-key="additional_info_placeholder" placeholder="Има ли нещо друго, което бихте искали да споделите?"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Box 5: Submission Button -->
                <div class="lg:col-span-2 text-center scroll-reveal" data-step="4">
                    <button type="submit" id="submit-button" class="submit-button-themed w-full sm:w-auto font-bold py-3 px-12 rounded-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4" data-translate-key="submit_button">
                        Изпрати запитване
                    </button>
                </div>
            </div>
        </form>
    </div>
    
    <!-- Error Modal -->
    <div id="error-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50">
        <div class="relative mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <h3 class="h-themed text-lg leading-6 font-medium" data-translate-key="error_modal_title">Грешка при изпращане</h3>
                <div class="mt-2 px-7 py-3">
                    <p id="error-message" class="text-sm p-themed" data-translate-key="error_modal_message">Възникна проблем при изпращането на формуляра. Моля, опитайте отново.</p>
                </div>
                <div class="items-center px-4 py-3">
                    <button id="close-error-modal-btn" class="submit-button-themed px-4 py-2 text-base font-medium rounded-md w-full shadow-sm focus:outline-none focus:ring-2" data-translate-key="error_modal_close">
                        Затвори
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Business Card Modal -->
    <div id="business-card-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4">
        <div class="relative bg-white p-8 rounded-lg shadow-lg max-w-sm w-full text-center">
            <span id="close-business-card-modal" class="absolute top-2 right-2 text-gray-500 hover:text-gray-800 text-3xl cursor-pointer font-bold">&times;</span>
            <img src="https://i.ibb.co/RpjmSmGd/485729087-122205037196106247-8647253442657459283-n.jpg" alt="Agent Photo" class="w-32 h-32 object-cover object-top rounded-full mx-auto mb-4 border-2" style="border-color: var(--color-accent); object-position: center 25%;">
            <h2 class="text-2xl font-bold h-themed" data-translate-key="card_agent_name">Цветелина Иванова</h2>
            <p class="p-themed mt-1" data-translate-key="card_agent_title">консултант недвижими имоти - ново строителство</p>
            <div class="mt-6 border-t pt-6 border-themed">
                <div class="mt-4 space-y-2">
                    <p class="p-themed"><strong data-translate-key="card_phone_label">Телефон:</strong> <a href="tel:0894799475" class="hover:underline" style="color: var(--color-accent);">0894799475</a></p>
                    <p class="p-themed"><strong data-translate-key="card_email_label">Имейл:</strong> <a href="mailto:tsvetelina.avramova@icloud.com" class="hover:underline" style="color: var(--color-accent);">tsvetelina.avramova@icloud.com</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Accent Color Picker Modal -->
    <div id="color-picker-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4">
        <div class="bg-white p-8 rounded-lg shadow-lg text-center">
            <h2 class="text-2xl font-bold h-themed" data-translate-key="color_picker_title">Choose Your Accent Color</h2>
             <p class="p-themed mt-2 mb-6" data-translate-key="color_picker_subtitle">This will personalize your experience.</p>
            <div class="flex justify-center gap-4">
                <button class="w-12 h-12 rounded-full bg-sky-500" data-color="#0ea5e9" data-hover="#0284c7" data-ring="#7dd3fc"></button>
                <button class="w-12 h-12 rounded-full bg-emerald-500" data-color="#10b981" data-hover="#059669" data-ring="#6ee7b7"></button>
                <button class="w-12 h-12 rounded-full bg-amber-500" data-color="#f59e0b" data-hover="#d97706" data-ring="#fcd34d"></button>
                <button class="w-12 h-12 rounded-full bg-rose-500" data-color="#f43f5e" data-hover="#e11d48" data-ring="#fda4af"></button>
                <button class="w-12 h-12 rounded-full bg-violet-500" data-color="#8b5cf6" data-hover="#7c3aed" data-ring="#c4b5fd"></button>
            </div>
        </div>
    </div>


    <script>
        // All JavaScript logic from the previous version remains here.
        // The new features are integrated below.
        
        let currentLang = 'bg'; // To keep track of the current language

        // Translations object
        const translations = {
            en: {
                main_title: 'Real Estate Inquiry',
                main_subtitle: 'Please fill out the form below and we will get back to you shortly.',
                user_role_title: 'Are you a...',
                role_buyer: 'Buyer',
                role_seller: 'Seller',
                property_details_title: 'Property Details',
                sqm_label_buyer: 'Desired Square Meters (m²)',
                sqm_label_seller: 'Square Meters (m²)',
                sqm_placeholder: 'e.g., 120-150',
                bedrooms_label: 'Number of Bedrooms',
                bedrooms_placeholder: 'e.g., 3',
                buyer_info_title: "Buyer's Information",
                budget_label_buyer: 'What is your budget?',
                budget_placeholder: 'e.g., 125000',
                area_label: 'Preferred Area(s)',
                area_placeholder: 'e.g., Downtown, North Suburbs',
                property_type_label_buyer: 'What property are you looking for?',
                property_type_label_seller: 'What property are you selling?',
                property_type_house: 'House',
                property_type_flat: 'Apartment / Flat',
                property_type_parcel: 'Parcel',
                property_type_business_building: 'Business Building',
                property_type_living_building: 'Living Building',
                property_type_vacational_property: 'Vacational Property',
                parking_needs_label: 'Parking Needs',
                garage_label: 'Garage',
                parking_spot_label: 'Parking Spot',
                seller_info_title: "Seller's Information",
                year_built_label: 'Year of Building',
                year_built_placeholder: 'e.g., 1995',
                building_type_label: 'Type of Building',
                building_type_tuhla: 'Brick',
                building_type_epk: 'EPK',
                building_type_panel: 'Panel',
                property_features_label: 'Property Features',
                garage_label_seller: 'Garage',
                parking_spot_label_seller: 'Parking Spot',
                sell_within_6_months_label: 'I want to sell within the next 6 months',
                contact_details_title: 'Contact Details',
                full_name_label: 'Your Names',
                full_name_placeholder: 'John Doe',
                phone_label: 'Phone Number',
                phone_placeholder: '+1 (555) 123-4567',
                email_label: 'Email Address',
                email_placeholder: 'you@example.com',
                additional_info_label: 'Additional Information',
                additional_info_placeholder: "Is there anything else you'd like to share?",
                submit_button: 'Submit Inquiry',
                submit_button_sending: 'Sending...',
                success_title: 'Thank You!',
                success_message: 'Your inquiry has been submitted successfully. We will contact you shortly.',
                error_modal_title: 'Submission Error',
                error_modal_message: 'There was a problem submitting your form. Please try again.',
                error_modal_close: 'Close',
                card_agent_name: 'Tsvetelina Ivanova',
                card_agent_title: 'Real Estate Consultant - New Construction',
                card_phone_label: 'Phone:',
                card_email_label: 'Email:',
                color_picker_title: 'Choose Your Accent Color',
                color_picker_subtitle: 'This will personalize your experience.',
                financing_status_label: 'Financing Status',
                financing_status_preapproved: 'Pre-approved for a loan',
                financing_status_cash: 'Paying with cash',
                financing_status_need_loan: 'Need to apply for a loan',
                financing_status_starting: 'Just starting to look',
                purchase_timeline_label: 'When do you plan to buy?',
                timeline_immediately: 'Immediately',
                timeline_1_3_months: '1-3 months',
                timeline_3_6_months: '3-6 months',
                timeline_6_plus_months: '6+ months',
                must_have_features_label: 'Must-Have Features',
                feature_balcony: 'Balcony/Terrace',
                feature_renovated: 'Renovated',
                feature_pet_friendly: 'Pet-Friendly',
                property_condition_label: 'Property Condition',
                condition_move_in: 'Move-in ready',
                condition_minor_updates: 'Needs minor updates',
                condition_major_renovation: 'Needs major renovation',
                reason_for_selling_label: 'Reason for Selling (optional)',
                photo_upload_label: 'Upload Property Photos',
            },
            bg: {
                main_title: 'Запитване за имот',
                main_subtitle: 'Моля, попълнете формуляра по-долу и ние ще се свържем с вас скоро.',
                user_role_title: 'Вие сте...',
                role_buyer: 'Купувач',
                role_seller: 'Продавач',
                property_details_title: 'Детайли за имота',
                sqm_label_buyer: 'Желана квадратура (м²)',
                sqm_label_seller: 'Квадратура (м²)',
                sqm_placeholder: 'напр. 120-150',
                bedrooms_label: 'Брой спални',
                bedrooms_placeholder: 'напр. 3',
                buyer_info_title: 'Информация за купувача',
                budget_label_buyer: 'Какъв е Вашият бюджет?',
                budget_placeholder: 'напр. 125000',
                area_label: 'Предпочитан(и) район(и)',
                area_placeholder: 'напр. Център, Северни квартали',
                property_type_label_buyer: 'Какъв имот търсите?',
                property_type_label_seller: 'Какъв имот продавате?',
                property_type_house: 'Къща',
                property_type_flat: 'Апартамент',
                property_type_parcel: 'Парцел',
                property_type_business_building: 'Бизнес сграда',
                property_type_living_building: 'Жилищна сграда',
                property_type_vacational_property: 'Ваканционен имот',
                parking_needs_label: 'Нужди за паркиране',
                garage_label: 'Гараж',
                parking_spot_label: 'Паркомясто',
                seller_info_title: 'Информация за продавача',
                year_built_label: 'Година на строеж',
                year_built_placeholder: 'напр. 1995',
                building_type_label: 'Тип на сградата',
                building_type_tuhla: 'Тухла',
                building_type_epk: 'ЕПК',
                building_type_panel: 'Панел',
                property_features_label: 'Характеристики на имота',
                garage_label_seller: 'Гараж',
                parking_spot_label_seller: 'Паркомясто',
                sell_within_6_months_label: 'Искам да продам в рамките на следващите 6 месеца',
                contact_details_title: 'Данни за контакт',
                full_name_label: 'Вашите имена',
                full_name_placeholder: 'Иван Иванов',
                phone_label: 'Телефонен номер',
                phone_placeholder: '+359 88 123 4567',
                email_label: 'Имейл адрес',
                email_placeholder: 'vasia@primer.com',
                additional_info_label: 'Допълнителна информация',
                additional_info_placeholder: 'Има ли нещо друго, което бихте искали да споделите?',
                submit_button: 'Изпрати запитване',
                submit_button_sending: 'Изпращане...',
                success_title: 'Благодарим Ви!',
                success_message: 'Вашето запитване беше изпратено успешно. Ще се свържем с Вас скоро.',
                error_modal_title: 'Грешка при изпращане',
                error_modal_message: 'Възникна проблем при изпращането на формуляра. Моля, опитайте отново.',
                error_modal_close: 'Затвори',
                card_agent_name: 'Цветелина Иванова',
                card_agent_title: 'консултант недвижими имоти - ново строителство',
                card_phone_label: 'Телефон:',
                card_email_label: 'Имейл:',
                color_picker_title: 'Изберете акцентен цвят',
                color_picker_subtitle: 'Това ще персонализира изживяването Ви.',
                financing_status_label: 'Статус на финансиране',
                financing_status_preapproved: 'Предварително одобрен за кредит',
                financing_status_cash: 'Плащане в брой',
                financing_status_need_loan: 'Трябва да кандидатствам за кредит',
                financing_status_starting: 'Проучвам възможности',
                purchase_timeline_label: 'Кога планирате да купите?',
                timeline_immediately: 'Веднага',
                timeline_1_3_months: '1-3 месеца',
                timeline_3_6_months: '3-6 месеца',
                timeline_6_plus_months: '6+ месеца',
                must_have_features_label: 'Задължителни екстри',
                feature_balcony: 'Балкон/Тераса',
                feature_renovated: 'Реновиран',
                feature_pet_friendly: 'Подходящ за домашни любимци',
                property_condition_label: 'Състояние на имота',
                condition_move_in: 'Готов за нанасяне',
                condition_minor_updates: 'Нуждае се от леки подобрения',
                condition_major_renovation: 'Нуждае се от основен ремонт',
                reason_for_selling_label: 'Причина за продажба (по желание)',
                photo_upload_label: 'Качете снимки на имота',
            }
        };

        function setLanguage(lang) {
            currentLang = lang;
            document.documentElement.lang = lang;
            document.title = lang === 'bg' ? 'Формуляр за запитване за имот' : 'Real Estate Inquiry Form';
            
            const elements = document.querySelectorAll('[data-translate-key]');
            elements.forEach(el => {
                const key = el.getAttribute('data-translate-key');
                const translation = translations[lang][key];
                if (translation !== undefined) {
                    if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                        el.placeholder = translation;
                    } else {
                        el.innerHTML = translation;
                    }
                }
            });
            
            document.getElementById('lang-bg').classList.toggle('active', lang === 'bg');
            document.getElementById('lang-en').classList.toggle('active', lang === 'en');
            
            toggleFormSections();
            handlePropertyTypeChange();
        }

        function toggleFormSections() {
            const buyerSection = document.getElementById('buyer-section');
            const sellerSection = document.getElementById('seller-section');
            const sqmLabel = document.getElementById('sqm-label');
            const propertyTypeLabel = document.getElementById('property-type-label');
            
            if (document.getElementById('role-buyer').checked) {
                buyerSection.classList.remove('hidden');
                sellerSection.classList.add('hidden');
                sqmLabel.innerHTML = translations[currentLang].sqm_label_buyer;
                propertyTypeLabel.innerHTML = translations[currentLang].property_type_label_buyer;
            } else {
                buyerSection.classList.add('hidden');
                sellerSection.classList.remove('hidden');
                sqmLabel.innerHTML = translations[currentLang].sqm_label_seller;
                propertyTypeLabel.innerHTML = translations[currentLang].property_type_label_seller;
            }
            handlePropertyTypeChange();
            updateProgressBar();
        }

        function handlePropertyTypeChange() {
            const propertyTypeDropdown = document.getElementById('property-type');
            const selectedOption = propertyTypeDropdown.options[propertyTypeDropdown.selectedIndex];
            const isLand = selectedOption.getAttribute('data-translate-key') === 'property_type_parcel';

            const bedroomsContainer = document.getElementById('bedrooms-container');
            const parkingContainer = document.getElementById('parking-container');
            const budgetContainer = document.getElementById('budget-container');
            
            const sellerParkingContainer = document.getElementById('seller-parking-container');
            const yearBuiltContainer = document.getElementById('year-built-container');
            const buildingTypeContainer = document.getElementById('building-type-container');
            
            const isBuyer = document.getElementById('role-buyer').checked;

            if (isLand) {
                bedroomsContainer.classList.add('hidden');
                if (isBuyer) {
                    parkingContainer.classList.add('hidden');
                } else { // isSeller
                    sellerParkingContainer.classList.add('hidden');
                    yearBuiltContainer.classList.add('hidden');
                    buildingTypeContainer.classList.add('hidden');
                }
            } else {
                bedroomsContainer.classList.remove('hidden');
                if (isBuyer) {
                    parkingContainer.classList.remove('hidden');
                } else { // isSeller
                    sellerParkingContainer.classList.remove('hidden');
                    yearBuiltContainer.classList.remove('hidden');
                    buildingTypeContainer.classList.remove('hidden');
                }
            }
        }

        function applyTheme(color, hover, ring) {
            const root = document.documentElement;
            root.style.setProperty('--color-accent', color);
            root.style.setProperty('--color-accent-hover', hover);
            root.style.setProperty('--color-accent-ring', ring);
        }

        function saveTheme(color, hover, ring) {
            localStorage.setItem('theme-accent-color', color);
            localStorage.setItem('theme-accent-hover', hover);
            localStorage.setItem('theme-accent-ring', ring);
        }

        function updateProgressBar() {
            const form = document.getElementById('real-estate-inquiry-form');
            const inputs = Array.from(form.querySelectorAll('input[required], select[required], textarea[required]'));
            let completed = 0;
            inputs.forEach(input => {
                if ((input.type === 'checkbox' && input.checked) || (input.type !== 'checkbox' && input.value !== '')) {
                    completed++;
                }
            });
            const progress = (completed / inputs.length) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
        }

        function initAutocomplete() {
            const input = document.getElementById('area');
            const autocomplete = new google.maps.places.Autocomplete(input);
        }

        document.addEventListener('DOMContentLoaded', function() {
            
            toggleFormSections();
            handlePropertyTypeChange();

            document.getElementById('lang-bg').addEventListener('click', () => setLanguage('bg'));
            document.getElementById('lang-en').addEventListener('click', () => setLanguage('en'));
            document.getElementById('property-type').addEventListener('change', handlePropertyTypeChange);
            document.querySelectorAll('input[name="user_role"]').forEach(radio => {
                radio.addEventListener('change', toggleFormSections);
            });
            
            document.getElementById('real-estate-inquiry-form').addEventListener('input', updateProgressBar);

            setLanguage('bg');

            const colorPickerModal = document.getElementById('color-picker-modal');
            const openColorPicker = document.getElementById('openColorPicker');
            const savedColor = localStorage.getItem('theme-accent-color');

            if (!savedColor) {
                colorPickerModal.classList.remove('hidden');
                document.body.classList.add('modal-open');
            } else {
                const savedHover = localStorage.getItem('theme-accent-hover');
                const savedRing = localStorage.getItem('theme-accent-ring');
                applyTheme(savedColor, savedHover, savedRing);
            }
            
            openColorPicker.addEventListener('click', () => {
                 colorPickerModal.classList.remove('hidden');
                 document.body.classList.add('modal-open');
            });

            document.querySelectorAll('#color-picker-modal button').forEach(button => {
                button.addEventListener('click', () => {
                    const color = button.dataset.color;
                    const hover = button.dataset.hover;
                    const ring = button.dataset.ring;
                    applyTheme(color, hover, ring);
                    saveTheme(color, hover, ring);
                    colorPickerModal.classList.add('hidden');
                    document.body.classList.remove('modal-open');
                });
            });

            const businessCardIcon = document.getElementById('openBusinessCard');
            const businessCardModal = document.getElementById('business-card-modal');
            const closeBusinessCardModal = document.getElementById('close-business-card-modal');

            businessCardIcon.addEventListener('click', () => {
                businessCardModal.classList.remove('hidden');
                document.body.classList.add('modal-open');
            });

            const closeCardModal = () => {
                businessCardModal.classList.add('hidden');
                document.body.classList.remove('modal-open');
            }

            closeBusinessCardModal.addEventListener('click', closeCardModal);
            businessCardModal.addEventListener('click', (e) => {
                if(e.target === businessCardModal) {
                    closeCardModal();
                }
            });

            const form = document.getElementById('real-estate-inquiry-form');
            const submitButton = document.getElementById('submit-button');
            const errorModal = document.getElementById('error-modal');
            const closeErrorModalBtn = document.getElementById('close-error-modal-btn');

            form.addEventListener('submit', async function(event) {
                event.preventDefault();

                const originalButtonText = submitButton.innerHTML;
                submitButton.disabled = true;
                submitButton.innerHTML = translations[currentLang].submit_button_sending;

                const formData = new FormData(form);
                const formAction = form.getAttribute('action');

                fetch(formAction, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Accept': 'application/json'
                    }
                })
                .then(response => {
                    if (response.ok) {
                        const formContainer = document.getElementById('form-container');
                        const successTitle = translations[currentLang].success_title;
                        const successMessage = translations[currentLang].success_message;
                        formContainer.innerHTML = `<div class="text-center p-8"><h2 class="text-2xl font-bold" style="color: var(--color-accent);">${successTitle}</h2><p class="p-themed mt-4">${successMessage}</p></div>`;
                    } else {
                        response.json().then(data => {
                            console.error("Formspree error:", data);
                            errorModal.classList.remove('hidden');
                        }).catch(() => {
                            errorModal.classList.remove('hidden');
                        });
                        submitButton.disabled = false;
                        submitButton.innerHTML = originalButtonText;
                    }
                })
                .catch(error => {
                    console.error("Network error:", error);
                    errorModal.classList.remove('hidden');
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalButtonText;
                });
            });

            closeErrorModalBtn.addEventListener('click', function() {
                errorModal.classList.add('hidden');
            });

            gsap.registerPlugin(ScrollTrigger);
            
            gsap.utils.toArray('.scroll-reveal').forEach(elem => {
                gsap.fromTo(elem, 
                    { opacity: 0, y: 50 }, 
                    { 
                        opacity: 1, 
                        y: 0,
                        duration: 1,
                        ease: 'power3.out',
                        scrollTrigger: {
                            trigger: elem,
                            start: 'top 90%',
                            toggleActions: 'play none none none'
                        }
                    }
                );
            });

            // Real-time validation
            const emailInput = document.getElementById('email');
            const phoneInput = document.getElementById('phone');
            const emailValidationIcon = document.getElementById('email-validation-icon');
            const phoneValidationIcon = document.getElementById('phone-validation-icon');

            const validateEmail = () => {
                const email = emailInput.value;
                const isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
                emailValidationIcon.classList.remove('hidden');
                emailValidationIcon.innerHTML = isValid ? '&#10003;' : '&#10005;';
                emailValidationIcon.style.color = isValid ? 'green' : 'red';
            };

            const validatePhone = () => {
                const phone = phoneInput.value;
                const isValid = /^\+?[0-9\s-()]{7,}$/.test(phone);
                phoneValidationIcon.classList.remove('hidden');
                phoneValidationIcon.innerHTML = isValid ? '&#10003;' : '&#10005;';
                phoneValidationIcon.style.color = isValid ? 'green' : 'red';
            };

            emailInput.addEventListener('input', validateEmail);
            phoneInput.addEventListener('input', validatePhone);

            // Photo Previews
            const photoInput = document.getElementById('property-photos');
            const photoPreviews = document.getElementById('photo-previews');
            photoInput.addEventListener('change', () => {
                photoPreviews.innerHTML = '';
                const files = photoInput.files;
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    if (file.type.startsWith('image/')){
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            img.className = 'w-full h-24 object-cover rounded-lg';
                            photoPreviews.appendChild(img);
                        }
                        reader.readAsDataURL(file);
                    }
                }
            });
        });
    </script>

</body>
</html>
