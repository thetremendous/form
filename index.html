<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Формуляр за запитване за имот</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter for body and Playfair Display for headlines -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet">
    <!-- Three.js for 3D Hero Section -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <style>
        /* Custom styles to enhance the form with a dynamic color palette and new typography */
        :root {
            --color-bg: #f4f1eb; /* Sand */
            --color-surface: #ffffff; /* White */
            --color-text-primary: #333333; /* Charcoal */
            --color-text-secondary: #6b7280; /* Soft Gray */
            --color-border: #d1d5db; /* Soft Gray */
            
            /* Default Accent Color (will be overridden by user selection) */
            --color-accent: #0ea5e9; /* Vibrant Sky Blue */
            --color-accent-hover: #0284c7;
            --color-accent-ring: #7dd3fc;

            --font-body: 'Inter', sans-serif;
            --font-headline: 'Playfair Display', serif;
        }

        body {
            font-family: var(--font-body);
            background-color: var(--color-bg);
            color: var(--color-text-primary);
        }

        #hero-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        .form-container-themed {
            background-color: var(--color-surface);
            position: relative;
            z-index: 1;
        }

        .border-themed {
            border-color: var(--color-border);
        }
        
        .h-themed {
             color: var(--color-text-primary);
             font-family: var(--font-headline);
             font-weight: 800;
        }

        .h-section-themed {
             color: var(--color-text-primary);
             font-family: var(--font-body);
             font-weight: 600;
        }

        .p-themed {
            color: var(--color-text-secondary);
        }

        .user-role-label {
            transition: all 0.2s ease-in-out;
            border-color: var(--color-border);
            color: var(--color-text-secondary);
        }
        
        input[type="radio"]:checked + .user-role-label {
            background-color: var(--color-accent);
            color: white;
            border-color: var(--color-accent);
        }

        input[type="radio"] {
            display: none;
        }

        .lang-switcher button.active {
            background-color: var(--color-accent);
            color: white;
        }
        
        .form-input-themed {
            border-color: var(--color-border);
        }

        .form-input-themed:focus {
            --tw-ring-color: var(--color-accent-ring);
            border-color: var(--color-accent);
        }
        
        .checkbox-themed {
             color: var(--color-accent);
        }
        
        .submit-button-themed {
            background-color: var(--color-accent);
            color: white;
        }
        .submit-button-themed:hover {
             background-color: var(--color-accent-hover);
        }
        .submit-button-themed:focus {
             --tw-ring-color: var(--color-accent-ring);
        }

        button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        .modal-open {
            overflow: hidden;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 sm:p-6 lg:p-8">

    <canvas id="hero-canvas"></canvas>

    <div id="form-container" class="form-container-themed w-full max-w-4xl rounded-xl shadow-lg p-6 sm:p-8 lg:p-10 relative">
        
        <!-- Business Card Icon -->
        <div class="absolute top-6 left-6">
            <button id="openBusinessCard" class="w-16 h-16 rounded-full bg-cover border-2 border-slate-600 hover:border-sky-400 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-2 focus:ring-offset-slate-100" style="background-image: url('https://i.ibb.co/RpjmSmGd/485729087-122205037196106247-8647253442657459283-n.jpg'); background-position: center 25%;" aria-label="Open Business Card"></button>
        </div>

        <!-- Language Switcher -->
        <div class="lang-switcher flex justify-end mb-4">
            <div class="inline-flex rounded-md shadow-sm" role="group">
                <button type="button" id="lang-bg" class="px-4 py-2 text-sm font-medium bg-white border border-gray-200 rounded-l-lg hover:bg-gray-100 focus:z-10 focus:ring-2">
                    BG
                </button>
                <button type="button" id="lang-en" class="px-4 py-2 text-sm font-medium bg-white border-t border-b border-r border-gray-200 rounded-r-lg hover:bg-gray-100 focus:z-10 focus:ring-2">
                    EN
                </button>
            </div>
        </div>

        <div class="text-center mb-8">
            <h1 class="h-themed text-4xl sm:text-5xl" data-translate-key="main_title">Запитване за имот</h1>
            <p class="p-themed mt-4 text-lg" data-translate-key="main_subtitle">Моля, попълнете формуляра по-долу и ние ще се свържем с вас скоро.</p>
        </div>

        <!-- The form now points to your specific Formspree endpoint -->
        <form id="real-estate-inquiry-form" action="https://formspree.io/f/mjkrdyrp" method="POST">
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Box 1: User Role -->
                <div class="p-6 rounded-lg border border-themed">
                    <h2 class="h-section-themed text-xl font-semibold mb-4" data-translate-key="user_role_title">Вие сте...</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <input type="radio" id="role-buyer" name="user_role" value="Buyer" checked onchange="toggleFormSections()">
                            <label for="role-buyer" class="user-role-label flex items-center justify-center w-full p-4 rounded-lg cursor-pointer text-lg font-medium" data-translate-key="role_buyer">
                                Купувач
                            </label>
                        </div>
                        <div>
                            <input type="radio" id="role-seller" name="user_role" value="Seller" onchange="toggleFormSections()">
                            <label for="role-seller" class="user-role-label flex items-center justify-center w-full p-4 rounded-lg cursor-pointer text-lg font-medium" data-translate-key="role_seller">
                                Продавач
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Box 2: Property Details -->
                <div class="p-6 rounded-lg border border-themed">
                    <h3 class="h-section-themed text-xl font-semibold mb-4" data-translate-key="property_details_title">Детайли за имота</h3>
                    <div class="grid grid-cols-1 gap-6">
                        <!-- Property Type -->
                        <div>
                            <label for="property-type" id="property-type-label" class="block text-sm font-medium p-themed mb-1" data-translate-key="property_type_label_buyer">Какъв имот търсите?</label>
                            <select name="property_type" id="property-type" class="w-full px-4 py-2 border rounded-lg focus:ring-2 form-input-themed bg-white">
                                <option data-translate-key="property_type_house">Къща</option>
                                <option data-translate-key="property_type_flat" selected>Апартамент</option>
                                <option data-translate-key="property_type_parcel">Парцел</option>
                                <option data-translate-key="property_type_business_building">Бизнес сграда</option>
                                <option data-translate-key="property_type_living_building">Жилищна сграда</option>
                                <option data-translate-key="property_type_vacational_property">Ваканционен имот</option>
                            </select>
                        </div>
                        <!-- Square Meters -->
                        <div>
                            <label for="sqm" id="sqm-label" class="block text-sm font-medium p-themed mb-1" data-translate-key="sqm_label_buyer">Желана квадратура (м²)</label>
                            <input type="text" name="sqm" id="sqm" class="w-full px-4 py-2 border rounded-lg focus:ring-2 form-input-themed" data-translate-key="sqm_placeholder" placeholder="напр. 120-150">
                        </div>
                        <!-- Bedrooms -->
                        <div id="bedrooms-container">
                            <label for="bedrooms" class="block text-sm font-medium p-themed mb-1" data-translate-key="bedrooms_label">Брой спални</label>
                            <input type="number" name="bedrooms" id="bedrooms" class="w-full px-4 py-2 border rounded-lg focus:ring-2 form-input-themed" data-translate-key="bedrooms_placeholder" placeholder="напр. 3">
                        </div>
                    </div>
                </div>

                <!-- Box 3: Buyer/Seller Details (Spanning full width) -->
                <div class="lg:col-span-2 p-6 rounded-lg border border-themed">
                    <div id="buyer-section">
                        <h3 class="h-section-themed text-xl font-semibold mb-4" data-translate-key="buyer_info_title">Информация за купувача</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Budget -->
                            <div id="budget-container">
                                <label for="budget-text" class="block text-sm font-medium p-themed mb-1" data-translate-key="budget_label_buyer">Какъв е Вашият бюджет?</label>
                                <input type="text" name="budget" id="budget-text" class="w-full px-4 py-2 border rounded-lg focus:ring-2 form-input-themed" data-translate-key="budget_placeholder" placeholder="напр. 125000">
                            </div>
                            <!-- Area of Living -->
                            <div>
                                <label for="area" class="block text-sm font-medium p-themed mb-1" data-translate-key="area_label">Предпочитан(и) район(и)</label>
                                <input type="text" name="area" id="area" class="w-full px-4 py-2 border rounded-lg focus:ring-2 form-input-themed" data-translate-key="area_placeholder" placeholder="напр. Център, Северни квартали">
                            </div>
                            <!-- Parking/Garage Options -->
                            <div id="parking-container" class="md:col-span-2">
                                <label class="block text-sm font-medium p-themed mb-2" data-translate-key="parking_needs_label">Нужди за паркиране</label>
                                <div class="flex items-center space-x-6">
                                    <div class="flex items-center">
                                        <input id="buyer-garage" name="buyer_needs_garage" type="checkbox" value="Yes" class="h-4 w-4 border-gray-300 rounded focus:ring-2 checkbox-themed">
                                        <label for="buyer-garage" class="ml-2 block text-sm" data-translate-key="garage_label">Гараж</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input id="buyer-parking" name="buyer_needs_parking_spot" type="checkbox" value="Yes" class="h-4 w-4 border-gray-300 rounded focus:ring-2 checkbox-themed">
                                        <label for="buyer-parking" class="ml-2 block text-sm" data-translate-key="parking_spot_label">Паркомясто</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="seller-section" class="hidden">
                        <h3 class="h-section-themed text-xl font-semibold mb-4" data-translate-key="seller_info_title">Информация за продавача</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Year of Building -->
                            <div id="year-built-container">
                                <label for="year-built" class="block text-sm font-medium p-themed mb-1" data-translate-key="year_built_label">Година на строеж</label>
                                <input type="number" name="year_built" id="year-built" class="w-full px-4 py-2 border rounded-lg focus:ring-2 form-input-themed" data-translate-key="year_built_placeholder" placeholder="напр. 1995">
                            </div>
                            <!-- Type of Building -->
                            <div id="building-type-container">
                                <label for="building-type" class="block text-sm font-medium p-themed mb-1" data-translate-key="building_type_label">Тип на сградата</label>
                                <select name="building_type" id="building-type" class="w-full px-4 py-2 border rounded-lg focus:ring-2 form-input-themed bg-white">
                                    <option data-translate-key="building_type_tuhla">Тухла</option>
                                    <option data-translate-key="building_type_epk">ЕПК</option>
                                    <option data-translate-key="building_type_panel">Панел</option>
                                </select>
                            </div>
                            <!-- Parking/Garage Options -->
                            <div id="seller-parking-container" class="md:col-span-2">
                                <label class="block text-sm font-medium p-themed mb-2" data-translate-key="property_features_label">Характеристики на имота</label>
                                <div class="flex items-center space-x-6">
                                    <div class="flex items-center">
                                        <input id="seller-garage" name="property_has_garage" type="checkbox" value="Yes" class="h-4 w-4 border-gray-300 rounded focus:ring-2 checkbox-themed">
                                        <label for="seller-garage" class="ml-2 block text-sm" data-translate-key="garage_label_seller">Гараж</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input id="seller-parking" name="property_has_parking_spot" type="checkbox" value="Yes" class="h-4 w-4 border-gray-300 rounded focus:ring-2 checkbox-themed">
                                        <label for="seller-parking" class="ml-2 block text-sm" data-translate-key="parking_spot_label_seller">Паркомясто</label>
                                    </div>
                                </div>
                            </div>
                            <!-- Sell within 6 months -->
                            <div class="md:col-span-2">
                                <div class="flex items-start">
                                    <div class="flex items-center h-5">
                                        <input id="sell-within-6-months" name="sell_within_6_months" type="checkbox" value="Yes" class="focus:ring-2 h-4 w-4 border-gray-300 rounded checkbox-themed">
                                    </div>
                                    <div class="ml-3 text-sm">
                                        <label for="sell-within-6-months" class="font-medium" data-translate-key="sell_within_6_months_label">Искам да продам в рамките на следващите 6 месеца</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Box 4: Contact Details (Spanning full width) -->
                <div class="lg:col-span-2 p-6 rounded-lg border border-themed">
                    <h3 class="h-section-themed text-xl font-semibold mb-4" data-translate-key="contact_details_title">Данни за контакт</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Name -->
                        <div>
                            <label for="name" class="block text-sm font-medium p-themed mb-1" data-translate-key="full_name_label">Вашите имена</label>
                            <input type="text" name="name" id="name" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 form-input-themed" data-translate-key="full_name_placeholder" placeholder="Иван Иванов">
                        </div>
                        <!-- Phone -->
                        <div>
                            <label for="phone" class="block text-sm font-medium p-themed mb-1" data-translate-key="phone_label">Телефонен номер</label>
                            <input type="tel" name="phone" id="phone" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 form-input-themed" data-translate-key="phone_placeholder" placeholder="+359 88 123 4567">
                        </div>
                        <!-- Email -->
                        <div class="md:col-span-2">
                            <label for="email" class="block text-sm font-medium p-themed mb-1" data-translate-key="email_label">Имейл адрес</label>
                            <input type="email" name="email" id="email" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 form-input-themed" data-translate-key="email_placeholder" placeholder="vasia@primer.com">
                        </div>
                        <!-- Additional Information -->
                        <div class="md:col-span-2">
                            <label for="message" class="block text-sm font-medium p-themed mb-1" data-translate-key="additional_info_label">Допълнителна информация</label>
                            <textarea name="message" id="message" rows="4" class="w-full px-4 py-2 border rounded-lg focus:ring-2 form-input-themed" data-translate-key="additional_info_placeholder" placeholder="Има ли нещо друго, което бихте искали да споделите?"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Box 5: Submission Button -->
                <div class="lg:col-span-2 text-center">
                    <button type="submit" id="submit-button" class="submit-button-themed w-full sm:w-auto font-bold py-3 px-12 rounded-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4" data-translate-key="submit_button">
                        Изпрати запитване
                    </button>
                </div>
            </div>
        </form>
    </div>
    
    <!-- Error Modal -->
    <div id="error-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50">
        <div class="relative mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <h3 class="h-themed text-lg leading-6 font-medium" data-translate-key="error_modal_title">Грешка при изпращане</h3>
                <div class="mt-2 px-7 py-3">
                    <p id="error-message" class="text-sm p-themed" data-translate-key="error_modal_message">Възникна проблем при изпращането на формуляра. Моля, опитайте отново.</p>
                </div>
                <div class="items-center px-4 py-3">
                    <button id="close-error-modal-btn" class="submit-button-themed px-4 py-2 text-base font-medium rounded-md w-full shadow-sm focus:outline-none focus:ring-2" data-translate-key="error_modal_close">
                        Затвори
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Business Card Modal -->
    <div id="business-card-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4">
        <div class="relative bg-white p-8 rounded-lg shadow-lg max-w-sm w-full text-center">
            <span id="close-business-card-modal" class="absolute top-2 right-2 text-gray-500 hover:text-gray-800 text-3xl cursor-pointer font-bold">&times;</span>
            <img src="https://i.ibb.co/RpjmSmGd/485729087-122205037196106247-8647253442657459283-n.jpg" alt="Agent Photo" class="w-32 h-32 object-cover object-top rounded-full mx-auto mb-4 border-2" style="border-color: var(--color-accent); object-position: center 25%;">
            <h2 class="text-2xl font-bold h-themed" data-translate-key="card_agent_name">Цветелина Иванова</h2>
            <p class="p-themed mt-1" data-translate-key="card_agent_title">консултант недвижими имоти - ново строителство</p>
            <div class="mt-6 border-t pt-6 border-themed">
                <div class="mt-4 space-y-2">
                    <p class="p-themed"><strong data-translate-key="card_phone_label">Телефон:</strong> <a href="tel:0894799475" class="hover:underline" style="color: var(--color-accent);">0894799475</a></p>
                    <p class="p-themed"><strong data-translate-key="card_email_label">Имейл:</strong> <a href="mailto:tsvetelina.avramova@icloud.com" class="hover:underline" style="color: var(--color-accent);">tsvetelina.avramova@icloud.com</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Accent Color Picker Modal -->
    <div id="color-picker-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4">
        <div class="bg-white p-8 rounded-lg shadow-lg text-center">
            <h2 class="text-2xl font-bold h-themed" data-translate-key="color_picker_title">Choose Your Accent Color</h2>
             <p class="p-themed mt-2 mb-6" data-translate-key="color_picker_subtitle">This will personalize your experience.</p>
            <div class="flex justify-center gap-4">
                <button class="w-12 h-12 rounded-full bg-sky-500" data-color="#0ea5e9" data-hover="#0284c7" data-ring="#7dd3fc"></button>
                <button class="w-12 h-12 rounded-full bg-emerald-500" data-color="#10b981" data-hover="#059669" data-ring="#6ee7b7"></button>
                <button class="w-12 h-12 rounded-full bg-amber-500" data-color="#f59e0b" data-hover="#d97706" data-ring="#fcd34d"></button>
                <button class="w-12 h-12 rounded-full bg-rose-500" data-color="#f43f5e" data-hover="#e11d48" data-ring="#fda4af"></button>
                <button class="w-12 h-12 rounded-full bg-violet-500" data-color="#8b5cf6" data-hover="#7c3aed" data-ring="#c4b5fd"></button>
            </div>
        </div>
    </div>


    <script>
        let currentLang = 'bg'; // To keep track of the current language

        // Translations object
        const translations = {
            en: {
                main_title: 'Real Estate Inquiry',
                main_subtitle: 'Please fill out the form below and we will get back to you shortly.',
                user_role_title: 'Are you a...',
                role_buyer: 'Buyer',
                role_seller: 'Seller',
                property_details_title: 'Property Details',
                sqm_label_buyer: 'Desired Square Meters (m²)',
                sqm_label_seller: 'Square Meters (m²)',
                sqm_placeholder: 'e.g., 120-150',
                bedrooms_label: 'Number of Bedrooms',
                bedrooms_placeholder: 'e.g., 3',
                buyer_info_title: "Buyer's Information",
                budget_label_buyer: 'What is your budget?',
                budget_placeholder: 'e.g., 125000',
                area_label: 'Preferred Area(s)',
                area_placeholder: 'e.g., Downtown, North Suburbs',
                property_type_label_buyer: 'What property are you looking for?',
                property_type_label_seller: 'What property are you selling?',
                property_type_house: 'House',
                property_type_flat: 'Apartment / Flat',
                property_type_parcel: 'Parcel',
                property_type_business_building: 'Business Building',
                property_type_living_building: 'Living Building',
                property_type_vacational_property: 'Vacational Property',
                parking_needs_label: 'Parking Needs',
                garage_label: 'Garage',
                parking_spot_label: 'Parking Spot',
                seller_info_title: "Seller's Information",
                year_built_label: 'Year of Building',
                year_built_placeholder: 'e.g., 1995',
                building_type_label: 'Type of Building',
                building_type_tuhla: 'Brick',
                building_type_epk: 'EPK',
                building_type_panel: 'Panel',
                property_features_label: 'Property Features',
                garage_label_seller: 'Garage',
                parking_spot_label_seller: 'Parking Spot',
                sell_within_6_months_label: 'I want to sell within the next 6 months',
                contact_details_title: 'Contact Details',
                full_name_label: 'Your Names',
                full_name_placeholder: 'John Doe',
                phone_label: 'Phone Number',
                phone_placeholder: '+1 (555) 123-4567',
                email_label: 'Email Address',
                email_placeholder: 'you@example.com',
                additional_info_label: 'Additional Information',
                additional_info_placeholder: "Is there anything else you'd like to share?",
                submit_button: 'Submit Inquiry',
                submit_button_sending: 'Sending...',
                success_title: 'Thank You!',
                success_message: 'Your inquiry has been submitted successfully. We will contact you shortly.',
                error_modal_title: 'Submission Error',
                error_modal_message: 'There was a problem submitting your form. Please try again.',
                error_modal_close: 'Close',
                card_agent_name: 'Tsvetelina Ivanova',
                card_agent_title: 'Real Estate Consultant - New Construction',
                card_phone_label: 'Phone:',
                card_email_label: 'Email:',
                color_picker_title: 'Choose Your Accent Color',
                color_picker_subtitle: 'This will personalize your experience.',
            },
            bg: {
                main_title: 'Запитване за имот',
                main_subtitle: 'Моля, попълнете формуляра по-долу и ние ще се свържем с вас скоро.',
                user_role_title: 'Вие сте...',
                role_buyer: 'Купувач',
                role_seller: 'Продавач',
                property_details_title: 'Детайли за имота',
                sqm_label_buyer: 'Желана квадратура (м²)',
                sqm_label_seller: 'Квадратура (м²)',
                sqm_placeholder: 'напр. 120-150',
                bedrooms_label: 'Брой спални',
                bedrooms_placeholder: 'напр. 3',
                buyer_info_title: 'Информация за купувача',
                budget_label_buyer: 'Какъв е Вашият бюджет?',
                budget_placeholder: 'напр. 125000',
                area_label: 'Предпочитан(и) район(и)',
                area_placeholder: 'напр. Център, Северни квартали',
                property_type_label_buyer: 'Какъв имот търсите?',
                property_type_label_seller: 'Какъв имот продавате?',
                property_type_house: 'Къща',
                property_type_flat: 'Апартамент',
                property_type_parcel: 'Парцел',
                property_type_business_building: 'Бизнес сграда',
                property_type_living_building: 'Жилищна сграда',
                property_type_vacational_property: 'Ваканционен имот',
                parking_needs_label: 'Нужди за паркиране',
                garage_label: 'Гараж',
                parking_spot_label: 'Паркомясто',
                seller_info_title: 'Информация за продавача',
                year_built_label: 'Година на строеж',
                year_built_placeholder: 'напр. 1995',
                building_type_label: 'Тип на сградата',
                building_type_tuhla: 'Тухла',
                building_type_epk: 'ЕПК',
                building_type_panel: 'Панел',
                property_features_label: 'Характеристики на имота',
                garage_label_seller: 'Гараж',
                parking_spot_label_seller: 'Паркомясто',
                sell_within_6_months_label: 'Искам да продам в рамките на следващите 6 месеца',
                contact_details_title: 'Данни за контакт',
                full_name_label: 'Вашите имена',
                full_name_placeholder: 'Иван Иванов',
                phone_label: 'Телефонен номер',
                phone_placeholder: '+359 88 123 4567',
                email_label: 'Имейл адрес',
                email_placeholder: 'vasia@primer.com',
                additional_info_label: 'Допълнителна информация',
                additional_info_placeholder: 'Има ли нещо друго, което бихте искали да споделите?',
                submit_button: 'Изпрати запитване',
                submit_button_sending: 'Изпращане...',
                success_title: 'Благодарим Ви!',
                success_message: 'Вашето запитване беше изпратено успешно. Ще се свържем с Вас скоро.',
                error_modal_title: 'Грешка при изпращане',
                error_modal_message: 'Възникна проблем при изпращането на формуляра. Моля, опитайте отново.',
                error_modal_close: 'Затвори',
                card_agent_name: 'Цветелина Иванова',
                card_agent_title: 'консултант недвижими имоти - ново строителство',
                card_phone_label: 'Телефон:',
                card_email_label: 'Имейл:',
                color_picker_title: 'Изберете акцентен цвят',
                color_picker_subtitle: 'Това ще персонализира изживяването Ви.',
            }
        };

        /**
         * Switches the form's language.
         * @param {string} lang - The language code ('en' or 'bg').
         */
        function setLanguage(lang) {
            currentLang = lang;
            document.documentElement.lang = lang;
            document.title = lang === 'bg' ? 'Формуляр за запитване за имот' : 'Real Estate Inquiry Form';
            
            const elements = document.querySelectorAll('[data-translate-key]');
            elements.forEach(el => {
                const key = el.getAttribute('data-translate-key');
                const translation = translations[lang][key];
                if (translation !== undefined) {
                    if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                        el.placeholder = translation;
                    } else {
                        el.innerHTML = translation;
                    }
                }
            });
            
            // Update active state on buttons
            document.getElementById('lang-bg').classList.toggle('active', lang === 'bg');
            document.getElementById('lang-en').classList.toggle('active', lang === 'en');
            
            // Re-run toggleFormSections to update dynamic labels
            toggleFormSections();
            handlePropertyTypeChange();
        }

        /**
         * Toggles the visibility of the buyer and seller form sections.
         */
        function toggleFormSections() {
            const buyerSection = document.getElementById('buyer-section');
            const sellerSection = document.getElementById('seller-section');
            const sqmLabel = document.getElementById('sqm-label');
            const propertyTypeLabel = document.getElementById('property-type-label');
            
            if (document.getElementById('role-buyer').checked) {
                buyerSection.classList.remove('hidden');
                sellerSection.classList.add('hidden');
                sqmLabel.innerHTML = translations[currentLang].sqm_label_buyer;
                propertyTypeLabel.innerHTML = translations[currentLang].property_type_label_buyer;
            } else {
                buyerSection.classList.add('hidden');
                sellerSection.classList.remove('hidden');
                sqmLabel.innerHTML = translations[currentLang].sqm_label_seller;
                propertyTypeLabel.innerHTML = translations[currentLang].property_type_label_seller;
            }
            handlePropertyTypeChange();
        }

        function handlePropertyTypeChange() {
            const propertyTypeDropdown = document.getElementById('property-type');
            const selectedOption = propertyTypeDropdown.options[propertyTypeDropdown.selectedIndex];
            const isLand = selectedOption.getAttribute('data-translate-key') === 'property_type_parcel';

            const bedroomsContainer = document.getElementById('bedrooms-container');
            const parkingContainer = document.getElementById('parking-container');
            const budgetContainer = document.getElementById('budget-container');
            
            const sellerParkingContainer = document.getElementById('seller-parking-container');
            const yearBuiltContainer = document.getElementById('year-built-container');
            const buildingTypeContainer = document.getElementById('building-type-container');
            
            const isBuyer = document.getElementById('role-buyer').checked;

            if (isLand) {
                bedroomsContainer.classList.add('hidden');
                if (isBuyer) {
                    parkingContainer.classList.add('hidden');
                } else { // isSeller
                    sellerParkingContainer.classList.add('hidden');
                    yearBuiltContainer.classList.add('hidden');
                    buildingTypeContainer.classList.add('hidden');
                }
            } else {
                bedroomsContainer.classList.remove('hidden');
                if (isBuyer) {
                    parkingContainer.classList.remove('hidden');
                } else { // isSeller
                    sellerParkingContainer.classList.remove('hidden');
                    yearBuiltContainer.classList.remove('hidden');
                    buildingTypeContainer.classList.remove('hidden');
                }
            }
        }

        function applyTheme(color, hover, ring) {
            const root = document.documentElement;
            root.style.setProperty('--color-accent', color);
            root.style.setProperty('--color-accent-hover', hover);
            root.style.setProperty('--color-accent-ring', ring);
        }

        function saveTheme(color, hover, ring) {
            localStorage.setItem('theme-accent-color', color);
            localStorage.setItem('theme-accent-hover', hover);
            localStorage.setItem('theme-accent-ring', ring);
        }

        // Initialize maps and set initial form state when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            
            // 3D Hero Section Logic
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('hero-canvas'), alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);

            const geometry = new THREE.TorusKnotGeometry(10, 3, 100, 16);
            const material = new THREE.MeshStandardMaterial({ color: 0xffffff, metalness: 0.7, roughness: 0.2 });
            const torusKnot = new THREE.Mesh(geometry, material);
            scene.add(torusKnot);

            const pointLight = new THREE.PointLight(0xffffff);
            pointLight.position.set(5, 5, 5);
            const ambientLight = new THREE.AmbientLight(0xffffff);
            scene.add(pointLight, ambientLight);

            camera.position.z = 30;

            let mouseX = 0;
            let mouseY = 0;
            document.addEventListener('mousemove', (event) => {
                mouseX = (event.clientX / window.innerWidth) * 2 - 1;
                mouseY = -(event.clientY / window.innerHeight) * 2 + 1;
            });

            function animate() {
                requestAnimationFrame(animate);
                torusKnot.rotation.y += 0.005;
                torusKnot.rotation.x += 0.001;
                
                // Mouse interaction
                torusKnot.rotation.y += mouseX * 0.01;
                torusKnot.rotation.x += mouseY * 0.01;

                renderer.render(scene, camera);
            }
            animate();

            window.addEventListener('resize', () => {
                renderer.setSize(window.innerWidth, window.innerHeight);
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
            });


            // Form Logic
            toggleFormSections();
            handlePropertyTypeChange();

            document.getElementById('lang-bg').addEventListener('click', () => setLanguage('bg'));
            document.getElementById('lang-en').addEventListener('click', () => setLanguage('en'));
            document.getElementById('property-type').addEventListener('change', handlePropertyTypeChange);
            document.querySelectorAll('input[name="user_role"]').forEach(radio => {
                radio.addEventListener('change', toggleFormSections);
            });


            setLanguage('bg');

            // Theme Picker Logic
            const colorPickerModal = document.getElementById('color-picker-modal');
            const savedColor = localStorage.getItem('theme-accent-color');

            if (!savedColor) {
                colorPickerModal.classList.remove('hidden');
                document.body.classList.add('modal-open');
            } else {
                const savedHover = localStorage.getItem('theme-accent-hover');
                const savedRing = localStorage.getItem('theme-accent-ring');
                applyTheme(savedColor, savedHover, savedRing);
            }

            document.querySelectorAll('#color-picker-modal button').forEach(button => {
                button.addEventListener('click', () => {
                    const color = button.dataset.color;
                    const hover = button.dataset.hover;
                    const ring = button.dataset.ring;
                    applyTheme(color, hover, ring);
                    saveTheme(color, hover, ring);
                    colorPickerModal.classList.add('hidden');
                    document.body.classList.remove('modal-open');
                });
            });


            // Business Card Modal Logic
            const businessCardIcon = document.getElementById('openBusinessCard');
            const businessCardModal = document.getElementById('business-card-modal');
            const closeBusinessCardModal = document.getElementById('close-business-card-modal');

            businessCardIcon.addEventListener('click', () => {
                businessCardModal.classList.remove('hidden');
                document.body.classList.add('modal-open');
            });

            const closeCardModal = () => {
                businessCardModal.classList.add('hidden');
                document.body.classList.remove('modal-open');
            }

            closeBusinessCardModal.addEventListener('click', closeCardModal);
            businessCardModal.addEventListener('click', (e) => {
                if(e.target === businessCardModal) {
                    closeCardModal();
                }
            });


            // Handle Form Submission with AJAX
            const form = document.getElementById('real-estate-inquiry-form');
            const submitButton = document.getElementById('submit-button');
            const errorModal = document.getElementById('error-modal');
            const closeErrorModalBtn = document.getElementById('close-error-modal-btn');

            form.addEventListener('submit', async function(event) {
                event.preventDefault(); // Stop default form submission

                const originalButtonText = submitButton.innerHTML;
                submitButton.disabled = true;
                submitButton.innerHTML = translations[currentLang].submit_button_sending;

                const formData = new FormData(form);
                const formAction = form.getAttribute('action');

                fetch(formAction, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Accept': 'application/json'
                    }
                })
                .then(response => {
                    if (response.ok) {
                        const formContainer = document.getElementById('form-container');
                        const successTitle = translations[currentLang].success_title;
                        const successMessage = translations[currentLang].success_message;
                        formContainer.innerHTML = `<div class="text-center p-8"><h2 class="text-2xl font-bold" style="color: var(--color-accent);">${successTitle}</h2><p class="p-themed mt-4">${successMessage}</p></div>`;
                    } else {
                        response.json().then(data => {
                            console.error("Formspree error:", data);
                            errorModal.classList.remove('hidden');
                        }).catch(() => {
                            errorModal.classList.remove('hidden');
                        });
                        submitButton.disabled = false;
                        submitButton.innerHTML = originalButtonText;
                    }
                })
                .catch(error => {
                    console.error("Network error:", error);
                    errorModal.classList.remove('hidden');
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalButtonText;
                });
            });

            closeErrorModalBtn.addEventListener('click', function() {
                errorModal.classList.add('hidden');
            });
        });
    </script>

</body>
</html>
